import{_ as i,o as u,c as r,a as n,b as e,w as t,e as o,d as s,r as l}from"./app.93f31f49.js";const d={},k=o('<h1 id="computed" tabindex="-1"><a class="header-anchor" href="#computed" aria-hidden="true">#</a> computed</h1><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>\u672C\u7BC7\u7B14\u8BB0\u5BF9\u5E94\u7684\u5206\u652F\u53F7\u4E3A: <code>main\u5206\u652F\uFF1A 139cae9</code></p></div><p><code>computed</code> \u63A5\u53D7\u4E00\u4E2A getter \u51FD\u6570\uFF0C\u5E76\u6839\u636E getter \u7684\u8FD4\u56DE\u503C\u8FD4\u56DE\u4E00\u4E2A <strong>\u4E0D\u53EF\u53D8</strong> \u7684\u54CD\u5E94\u5F0F <code>ref</code> \u5BF9\u8C61\u3002</p>',3),m={class:"custom-container tip"},v=n("p",{class:"custom-container-title"},"TIP",-1),b=s("\u5176\u5B9E "),h=n("code",null,"computed",-1),g=s(" \u8FD8\u53EF\u4EE5\u63A5\u53D7\u4E00\u4E2A\u5177\u6709 "),_=n("code",null,"get",-1),f=s(" \u548C "),y=n("code",null,"set",-1),w=s(" \u51FD\u6570\u7684\u5BF9\u8C61(\u53C2\u7167 "),x={href:"https://v3.cn.vuejs.org/api/computed-watch-api.html#computed",target:"_blank",rel:"noopener noreferrer"},V=s("computed"),C=s(" \u8FD9\u7BC7\u6587\u6863)\uFF0C\u7528\u6765\u521B\u5EFA\u53EF\u5199\u7684 "),B=n("code",null,"ref",-1),I=s(" \u5BF9\u8C61\uFF0C\u8FD9\u4E2A\u540E\u671F\u53EF\u4EE5\u8003\u8651\u5B9E\u73B0\u4E0B\uFF0C\u8FD9\u4E2A\u7AE0\u8282\u53EA\u8003\u8651\u7B2C\u4E00\u79CD\u60C5\u51B5"),R=n("h2",{id:"happy-path",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#happy-path","aria-hidden":"true"},"#"),s(" happy path")],-1),E=n("p",null,[s("\u6211\u4EEC\u8FD8\u662F\u5148\u4ECE\u7B80\u5355\u7684 "),n("code",null,"happy path"),s(" \u5165\u624B\uFF1A")],-1),T=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/__tests__/computed.spec.ts"),s(`

`),n("span",{class:"token function"},"it"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"happy path"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" user "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"reactive"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
    age`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"1"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token keyword"},"const"),s(" age "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"computed"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" user"),n("span",{class:"token punctuation"},"."),s("age"),n("span",{class:"token punctuation"},")"),s(`
  
  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("age"),n("span",{class:"token punctuation"},"."),s("value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),H=o("<p>\u6839\u636E\u6D4B\u8BD5\u7528\u4F8B\u6211\u4EEC\u53EF\u4EE5\u5F97\u51FA\uFF1A</p><blockquote><ol><li><code>computed</code> \u63A5\u53D7\u4E00\u4E2A\u51FD\u6570\uFF08\u6309\u7167\u5B98\u65B9\u7684\u8BF4\u6CD5\uFF0C\u6211\u4EEC\u53EB\u5B83 <code>getter</code>\uFF09;</li><li>\u8FD4\u56DE\u4E00\u4E2A <code>ref</code> \u5BF9\u8C61\uFF0C\u53EF\u4EE5\u901A\u8FC7 <code>.value</code> \u7684\u65B9\u5F0F\u53BB\u83B7\u53D6\u503C</li></ol></blockquote><p>\u6839\u636E\u4EE5\u4E0A\u63CF\u8FF0\uFF0C\u6211\u4EEC\u65B0\u5EFA <code>computed.ts</code> \u6587\u4EF6\u7528\u4E8E\u5B9A\u4E49 <code>computed</code> \u65B9\u6CD5\uFF0C\u5E76\u5B9A\u4E49 <code>ComputedRefImpl</code> \u7C7B\u7528\u4E8E\u505A\u540E\u7EED\u5904\u7406\uFF1A</p>",3),q=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/computed.ts"),s(`
`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"ComputedRefImpl"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"private"),s(" _getter"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),s(`
  
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_getter "),n("span",{class:"token operator"},"="),s(` getter
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token keyword"},"get"),s(),n("span",{class:"token function"},"value"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_getter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"computed"),s(),n("span",{class:"token operator"},"="),s(" getter "),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ComputedRefImpl"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),z=o('<p>\u8FD9\u6837\u4E00\u6765\uFF0C\u6211\u4EEC\u5C31\u5DF2\u7ECF\u521D\u6B65\u5B9E\u73B0\u4E86\u6211\u4EEC\u7684\u529F\u80FD\u3002</p><h2 id="\u5B9E\u73B0-computed-\u7684\u7F13\u5B58\u529F\u80FD" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0-computed-\u7684\u7F13\u5B58\u529F\u80FD" aria-hidden="true">#</a> \u5B9E\u73B0 computed \u7684\u7F13\u5B58\u529F\u80FD</h2><p>\u719F\u6089 <code>Vue</code> \u7684\u5C0F\u4F19\u4F34\u4EEC\u5E94\u8BE5\u77E5\u9053\uFF0C\u65E0\u8BBA\u662F <code>Vue2</code> \u8FD8\u662F <code>Vue3</code>\uFF0C<code>computed</code> \u90FD\u5177\u6709\u4E00\u4E2A\u7279\u6027\uFF0C\u90A3\u5C31\u662F <strong>\u7F13\u5B58</strong>\u3002</p><blockquote><ol><li>\u5F53 <code>computed</code> \u4E2D\u54CD\u5E94\u5F0F\u7684\u503C\u6CA1\u6709\u53D1\u751F\u53D8\u5316\u7684\u65F6\u5019\uFF0C<code>computed</code> \u4E0D\u4F1A\u91CD\u590D\u8BA1\u7B97\uFF0C\u4E5F\u5C31\u662F\u8BF4 <code>getter</code> \u4E0D\u4F1A\u91CD\u590D\u6267\u884C\uFF0C\u800C\u662F\u5C06\u4E0A\u4E00\u6B21\u7684\u8BA1\u7B97\u7ED3\u679C\u76F4\u63A5\u8FD4\u56DE\u3002</li><li>\u53EA\u6709\u5F53\u5176\u4E2D\u54CD\u5E94\u5F0F\u7684\u503C\u53D1\u751F\u53D8\u5316\u65F6\uFF0C<code>getter</code> \u65B9\u6CD5\u624D\u4F1A\u518D\u6B21\u89E6\u53D1\uFF0C\u5E76\u8FD4\u56DE\u6700\u65B0\u7684\u503C\u3002</li></ol></blockquote><p>\u6211\u4EEC\u5148\u6765\u5B9E\u73B0\u7B2C\u4E00\u4E2A\u7279\u6027\u3002\u9996\u5148\u8FD8\u662F\u5148\u901A\u8FC7\u6D4B\u8BD5\u7528\u4F8B\u6765\u634B\u4E00\u634B\u903B\u8F91\uFF1A</p>',5),G=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/__tests__/computed.spec.ts"),s(`

 `),n("span",{class:"token function"},"it"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"should compute lazily"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" value "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"reactive"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
    foo`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"1"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token keyword"},"const"),s(" getter "),n("span",{class:"token operator"},"="),s(" jest"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"fn"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" value"),n("span",{class:"token punctuation"},"."),s("foo"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" cValue "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"computed"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),s(`
  
  `),n("span",{class:"token comment"},"// lazy \u4E0D\u89E6\u53D1 get \u65F6\u4E0D\u4F1A\u6267\u884C getter \u65B9\u6CD5"),s(`
  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("not"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toHaveBeenCalled"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token comment"},"// \u89E6\u53D1 get \u65F6\u6267\u884C getter"),s(`
  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("cValue"),n("span",{class:"token punctuation"},"."),s("value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toHaveBeenCalledTimes"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token comment"},"// should not compute again"),s(`
  cValue`),n("span",{class:"token punctuation"},"."),s(`value
  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toHaveBeenCalledTimes"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),N=n("p",null,"\u90A3\u4E48\u8FD9\u4E2A\u7F13\u5B58\u7684\u529F\u80FD\u5E94\u8BE5\u600E\u4E48\u53BB\u5B9E\u73B0\u5462\uFF1F",-1),j=n("p",null,[s("\u8FD9\u91CC\u6211\u4EEC\u53EF\u4EE5\u5B9A\u4E49\u4E00\u4E2A\u5F00\u5173 "),n("code",null,"_dirty"),s("\uFF0C\u7528\u4E8E\u63A7\u5236\u662F\u5426\u9700\u8981\u89E6\u53D1 "),n("code",null,"getter"),s(" \u65B9\u6CD5\uFF0C\u5982\u679C "),n("code",null,"_dirty === true"),s(", \u90A3\u4E48\u5C31\u89E6\u53D1\uFF0C\u5426\u5219\u4E0D\u89E6\u53D1\u3002\u4E4B\u540E\u5B9A\u4E49 "),n("code",null,"_value"),s(" \u7528\u4E8E\u7F13\u5B58 "),n("code",null,"getter"),s(" \u7684\u6267\u884C\u7ED3\u679C\uFF1A")],-1),L=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/computed.ts"),s(`

`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"ComputedRefImpl"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"private"),s(" _getter"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),s(`
  `),n("span",{class:"token keyword"},"private"),s(" _dirty"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"boolean"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"true"),s(),n("span",{class:"token comment"},"// \u6807\u8BB0\u662F\u5426\u9700\u8981\u89E6\u53D1 getter"),s(`
  `),n("span",{class:"token keyword"},"private"),s(" _value"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),s(),n("span",{class:"token comment"},"// \u7F13\u5B58\u503C"),s(`
  
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_getter "),n("span",{class:"token operator"},"="),s(` getter
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token keyword"},"get"),s(),n("span",{class:"token function"},"value"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u503C\u6CA1\u6709\u53D1\u751F\u53D8\u5316\u65F6\uFF0C\u518D\u6B21\u83B7\u53D6\u4E0D\u4F1A\u89E6\u53D1 getter"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_dirty"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_dirty "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"false"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_value "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s(`_value
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),P=n("p",null,[s("\u73B0\u5728\uFF0C\u6211\u4EEC\u7684 "),n("code",null,"computed"),s(" \u5C31\u5177\u6709\u4E86\u7F13\u5B58\u7684\u80FD\u529B\uFF0C\u63A5\u4E0B\u6765\u6211\u4EEC\u9700\u8981\u5B9E\u73B0\u7B2C\u4E8C\u4E2A\u529F\u80FD\u70B9\u3002\u522B\u6025\uFF0C\u5F00\u59CB\u4E4B\u524D\uFF0C\u6211\u4EEC\u5148\u6765\u8865\u5145\u4E0B\u6D4B\u8BD5\u7528\u4F8B\uFF1A")],-1),S=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/__tests__/computed.spec.ts"),s(`

`),n("span",{class:"token function"},"it"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"should compute lazily"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" value "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"reactive"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
    foo`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"1"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token keyword"},"const"),s(" getter "),n("span",{class:"token operator"},"="),s(" jest"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"fn"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" value"),n("span",{class:"token punctuation"},"."),s("foo"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" cValue "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"computed"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),s(`
  
  `),n("span",{class:"token comment"},"// lazy"),s(`
  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("not"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toHaveBeenCalled"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("cValue"),n("span",{class:"token punctuation"},"."),s("value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toHaveBeenCalledTimes"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token comment"},"// should not compute again"),s(`
  cValue`),n("span",{class:"token punctuation"},"."),s(`value
  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toHaveBeenCalledTimes"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`
  
  `),n("span",{class:"token comment"},"// should not compute until needed"),s(`
  value`),n("span",{class:"token punctuation"},"."),s("foo "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"2"),s(`
  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toHaveBeenCalledTimes"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token comment"},"// now it should computed"),s(`
  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("cValue"),n("span",{class:"token punctuation"},"."),s("value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toHaveBeenCalledTimes"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),s(`

  `),n("span",{class:"token comment"},"// should not compute again"),s(`
  cValue`),n("span",{class:"token punctuation"},"."),s(`value
  `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toHaveBeenCalledTimes"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),A=o('<p>\u8865\u5145\u5B8C\u6D4B\u8BD5\u7528\u4F8B\uFF0C\u6211\u4EEC\u6267\u884C\u4E0B\u6D4B\u8BD5\u547D\u4EE4\uFF0C\u53D1\u73B0 <code>22-23\u884C</code> \u662F\u901A\u8FC7\u7684\u3002\u56E0\u4E3A\u6211\u4EEC\u76EE\u524D\u53EA\u662F\u8BBE\u7F6E\u4E86 <code>value.foo</code> \u7684\u503C\uFF0C\u5E76\u6CA1\u6709\u83B7\u53D6 <code>cValue.value</code> \uFF0C\u56E0\u6B64 <code>getter</code> \u4ECD\u7136\u53EA\u6267\u884C\u4E86\u4E00\u6B21\uFF0C\u6CA1\u6BDB\u75C5\u3002</p><p>\u4F46\u662F\u63A5\u4E0B\u6765\u5F53\u6211\u4EEC\u5C1D\u8BD5\u83B7\u53D6 <code>cValue.value</code> \u65F6\uFF0C\u53D1\u73B0\u6D4B\u8BD5\u7528\u4F8B\u65E0\u6CD5\u901A\u8FC7\u4E86\uFF1A</p><p><img src="https://user-images.githubusercontent.com/9375823/177301131-f838dd96-e682-48d2-a277-c5fd2f419fa4.png" alt="computed"></p><p>\u901A\u8FC7\u62A5\u9519\u4FE1\u606F\u6211\u4EEC\u53EF\u4EE5\u5F97\u77E5\uFF0C<code>cValue.value</code> \u7684\u503C\u5E76\u6CA1\u6709\u5982\u6211\u4EEC\u6240\u613F\u7684\u53D8\u62102\u3002\u539F\u56E0\u4E5F\u5F88\u7B80\u5355\uFF0C\u56E0\u4E3A\u5F53\u6211\u4EEC\u518D\u6B21\u83B7\u53D6 <code>cValue.value</code> \u65F6\uFF0C\u6B64\u65F6\u7684 <code>_dirty === false</code>\uFF0C\u56E0\u6B64\u4E0D\u4F1A\u91CD\u65B0\u6267\u884C <code>getter</code> \u65B9\u6CD5\uFF0C\u81EA\u7136\u4E5F\u5C31\u65E0\u6CD5\u8FD4\u56DE\u6700\u65B0\u7684\u503C\u3002</p><p>\u90A3\u4E48\u6211\u4EEC\u5E94\u8BE5\u5728\u4EC0\u4E48\u65F6\u5019\u5C06 <code>_dirty</code> \u7684\u503C\u91CD\u65B0\u8BBE\u7F6E\u4E3A <code>true</code> \u5462\uFF1F\u5176\u5B9E\u5728\u63CF\u8FF0 <strong>\u7B2C\u4E8C\u70B9</strong> \u7684\u65F6\u5019\u5C31\u5DF2\u7ECF\u900F\u9732\u4E86\uFF1A<strong>\u5728\u54CD\u5E94\u5F0F\u7684\u503C\u53D1\u751F\u53D8\u5316\u7684\u65F6\u5019</strong>\u3002\u5728\u8FD9\u91CC\uFF0C\u6211\u4EEC\u7684\u54CD\u5E94\u5F0F\u7684\u503C\u5176\u5B9E\u6307\u7684\u5C31\u662F <code>value.foo</code>\u3002</p><p>\u6211\u4EEC\u77E5\u9053\uFF0C\u5F53\u6211\u4EEC\u5728\u8BBE\u7F6E <code>value.foo</code> \u7684\u503C\u65F6\uFF0C\u4F1A\u89E6\u53D1 <code>set</code> \u65B9\u6CD5\uFF0C<code>set</code> \u65B9\u6CD5\u4E2D\u4F1A\u8C03\u7528 <code>trigger</code> \u65B9\u6CD5\u89E6\u53D1\u4F9D\u8D56\uFF0C\u6240\u4EE5\u6211\u4EEC\u53EA\u9700\u8981\u5728\u89E6\u53D1\u4F9D\u8D56\u7684\u8FC7\u7A0B\u4E2D\u5C06 <code>_dirty</code> \u8BBE\u7F6E\u4E3A <code>true</code> \u5373\u53EF\u3002\u90A3\u6211\u4EEC\u8981\u600E\u4E48\u624D\u80FD\u505A\u5230\u8FD9\u4E00\u70B9\u5462\uFF1F</p><h3 id="\u7B2C\u4E00\u6B65-\u6536\u96C6\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E00\u6B65-\u6536\u96C6\u4F9D\u8D56" aria-hidden="true">#</a> \u7B2C\u4E00\u6B65\uFF1A\u6536\u96C6\u4F9D\u8D56</h3><p>\u8981\u60F3\u89E6\u53D1\u4F9D\u8D56\uFF0C\u90A3\u5F97\u5148\u6536\u96C6\u4F9D\u8D56\uFF0C\u4E0D\u7136\u8C08\u4F55\u89E6\u53D1\uFF1F</p><p>\u73B0\u5728\u6211\u4EEC\u4E00\u8D77\u6765\u56DE\u5FC6\u4E00\u4E0B\uFF0C<strong>\u4F9D\u8D56\u6536\u96C6</strong> \u7684\u8FC7\u7A0B\u53D1\u751F\u5728 <code>get</code> \u9636\u6BB5\uFF0C\u5176\u4E2D\u7684 <code>track</code> \u65B9\u6CD5\u4F1A\u6536\u96C6 <code>activeEffect</code> \u5BF9\u8C61\uFF0C\u4E5F\u5C31\u662F <code>ReactiveEffect</code> \u7684\u5B9E\u4F8B\u5BF9\u8C61\u3002\u5728\u4E0A\u8FF0\u6D4B\u8BD5\u7528\u4F8B\u4E2D\uFF0C\u4EC0\u4E48\u65F6\u5019\u4F1A\u8C03\u7528 <code>value.foo</code> \u5462\uFF1F\u7B54\u6848\u662F\u5728\u9996\u6B21\u83B7\u53D6 <code>cValue.value</code> \u7684\u65F6\u5019\u3002\u65E2\u7136\u5982\u6B64\uFF0C\u6211\u4EEC\u5C31\u8981\u60F3\u529E\u6CD5\u5728\u6B64\u4E4B\u524D\u5C06 <code>this._dirty = true</code> \u7684\u64CD\u4F5C\u5B58\u5230 <code>activeEffect</code> \u5BF9\u8C61\u4E2D\uFF0C\u8FD9\u6837\u624D\u80FD\u8BA9 <code>track</code> \u6536\u96C6\u5230\u3002</p><p>\u65E2\u5982\u6B64\uFF0C\u6211\u4EEC\u5C31\u9700\u8981\u5C06 <code>ReactiveEffect</code> \u629B\u51FA\u6765\uFF0C\u5E76\u5728 <code>computed.ts</code> \u4E2D\u5F15\u5165\u3002\u5E76\u5728\u521D\u59CB\u5316 <code>ComputedRefImpl</code> \u65F6\u5B9E\u4F8B\u5316\u5B83\uFF1A</p>',10),D=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/effect.ts"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"ReactiveEffect"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u7701\u7565\u4E00\u5927\u6CE2\u4EE3\u7801"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),F=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/computed.ts"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" ReactiveEffect "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./effect'"),s(`

`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"ComputedRefImpl"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"private"),s(" _getter"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),s(`
  `),n("span",{class:"token keyword"},"private"),s(" _dirty"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"boolean"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"true"),s(),n("span",{class:"token comment"},"// \u6807\u8BB0\u662F\u5426\u9700\u8981\u89E6\u53D1 getter"),s(`
  `),n("span",{class:"token keyword"},"private"),s(" _value"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),s(),n("span",{class:"token comment"},"// \u7F13\u5B58\u503C"),s(`
  `),n("span",{class:"token keyword"},"private"),s(" _effect"),n("span",{class:"token operator"},":"),s(` ReactiveEffect
  
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),s("getter"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_getter "),n("span",{class:"token operator"},"="),s(` getter
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_effect "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ReactiveEffect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_getter"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_dirty"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_dirty "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"true"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token keyword"},"get"),s(),n("span",{class:"token function"},"value"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u503C\u6CA1\u6709\u53D1\u751F\u53D8\u5316\u65F6\uFF0C\u518D\u6B21\u83B7\u53D6\u4E0D\u4F1A\u89E6\u53D1 getter"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_dirty"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_dirty "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"false"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_value "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_effect"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"run"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s(`_value
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),J=o('<div class="custom-container warning"><p class="custom-container-title">\u6CE8\u610F</p><p>\u8FD9\u91CC\u6211\u4EEC\u5C06\u8BBE\u7F6E <code>_dirty</code> \u7684\u64CD\u4F5C\u653E\u5230\u4E86 <code>scheduler</code> \u4E2D\u3002\u4E3A\u4EC0\u4E48\u8FD9\u4E48\u505A\u5462\uFF1F\u56E0\u4E3A\u5728 <code>trigger</code> \u7684\u903B\u8F91\u4E2D\uFF0C\u5982\u679C\u6CA1\u6709 <code>scheduler</code>, \u5219\u4F1A\u6267\u884C <code>run</code> \u65B9\u6CD5\uFF0C\u8FD9\u6837\u4E00\u6765\u5C31\u4F1A\u591A\u89E6\u53D1\u4E00\u6B21 <code>getter</code>\u3002</p></div><p>\u8FD9\u6837\u4E00\u6765\uFF0C\u5728\u8BBE\u7F6E <code>value.foo</code> \u65F6\uFF0C\u4FBF\u4F1A\u6267\u884C\u5230 <code>scheduler</code> \u65B9\u6CD5\uFF0C\u8FDB\u800C\u6267\u884C <code>if (!this._dirty) this._dirty = true</code> \u3002\u5F53\u6211\u4EEC\u518D\u6B21\u83B7\u53D6 <code>cValue.value</code> \u65F6\uFF0C\u6B64\u65F6\u7684 <code>_dirty === true</code>\uFF0C\u4E4B\u540E\u4FBF\u80FD\u8FD4\u56DE\u6700\u65B0\u7684\u503C\u4E86\u3002\u800C\u4E14\u91CD\u590D\u8BBF\u95EE <code>cValue.value</code> \u65F6\u4E5F\u5C31\u4E0D\u4F1A\u518D\u6B21\u89E6\u53D1 <code>getter</code> \u65B9\u6CD5\u4E86\u3002</p><p>\u81F3\u6B64\uFF0C\u6211\u4EEC\u7684\u529F\u80FD\u5C31\u5DF2\u5B9E\u73B0\u5B8C\u6BD5~</p>',3);function K(M,O){const p=l("ExternalLinkIcon"),a=l("CodeGroupItem"),c=l("CodeGroup");return u(),r("div",null,[k,n("div",m,[v,n("p",null,[b,h,g,_,f,y,w,n("a",x,[V,e(p)]),C,B,I])]),R,E,e(c,null,{default:t(()=>[e(a,{title:"computed.spec.ts"},{default:t(()=>[T]),_:1})]),_:1}),H,e(c,null,{default:t(()=>[e(a,{title:"computed.ts"},{default:t(()=>[q]),_:1})]),_:1}),z,e(c,null,{default:t(()=>[e(a,{title:"computed.spec.ts"},{default:t(()=>[G]),_:1})]),_:1}),N,j,e(c,null,{default:t(()=>[e(a,{title:"computed.ts"},{default:t(()=>[L]),_:1})]),_:1}),P,e(c,null,{default:t(()=>[e(a,{title:"computed.spec.ts"},{default:t(()=>[S]),_:1})]),_:1}),A,e(c,null,{default:t(()=>[e(a,{title:"effect.ts"},{default:t(()=>[D]),_:1}),e(a,{title:"computed.ts"},{default:t(()=>[F]),_:1})]),_:1}),J])}var U=i(d,[["render",K],["__file","13_computed.html.vue"]]);export{U as default};
