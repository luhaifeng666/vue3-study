import{_ as i,r as p,o as u,c as r,a as n,b as e,w as a,d as s,e as o}from"./app.61bfa00f.js";const k={},d=n("h1",{id:"effect-reactive-\u4F9D\u8D56\u6536\u96C6-\u89E6\u53D1\u4F9D\u8D56",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#effect-reactive-\u4F9D\u8D56\u6536\u96C6-\u89E6\u53D1\u4F9D\u8D56","aria-hidden":"true"},"#"),s(" effect & reactive & \u4F9D\u8D56\u6536\u96C6 & \u89E6\u53D1\u4F9D\u8D56")],-1),m=n("div",{class:"custom-container tip"},[n("p",{class:"custom-container-title"},"TIP"),n("p",null,[s("\u672C\u7BC7\u7B14\u8BB0\u5BF9\u5E94\u7684\u5206\u652F\u53F7\u4E3A: "),n("code",null,"main\u5206\u652F\uFF1Ae8bb112")])],-1),b=s("\u5728 Vue3 \u4E2D\uFF0C"),v={href:"https://v3.cn.vuejs.org/api/basic-reactivity.html#reactive",target:"_blank",rel:"noopener noreferrer"},f=s("reactive"),_=s(" \u65B9\u6CD5\u88AB\u7528\u4E8E\u521B\u5EFA\u4E00\u4E2A\u5BF9\u8C61\u7684 "),g=n("strong",null,"\u54CD\u5E94\u5F0F\u526F\u672C",-1),h=s("\u3002\u8FD9\u91CC\u53EF\u4EE5\u62C6\u6210\u4E24\u4E2A\u90E8\u5206\u6765\u7406\u89E3\uFF0C\u5373 "),y=n("strong",null,"\u54CD\u5E94\u5F0F",-1),w=s(" \u4EE5\u53CA "),x=n("strong",null,"\u526F\u672C",-1),M=s("\u3002"),E=n("h2",{id:"\u526F\u672C",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u526F\u672C","aria-hidden":"true"},"#"),s(" \u526F\u672C")],-1),R=n("p",null,[s("\u6211\u4EEC\u5148\u6765\u770B\u770B "),n("strong",null,"\u526F\u672C"),s(" \u8FD9\u4E2A\u90E8\u5206\u3002\u5728\u5B9E\u73B0 "),n("code",null,"reactive"),s(" \u65B9\u6CD5\u4E4B\u524D\uFF0C\u6211\u4EEC\u5148\u6765\u5199\u4E0B\u5B83\u7684\u6D4B\u8BD5\u7528\u4F8B\uFF0C\u770B\u770B\u5B83\u9700\u8981\u505A\u4E9B\u5565\uFF1A")],-1),C=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/__tests__/reactive.spec.ts"),s(`

`),n("span",{class:"token function"},"describe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'reactive'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"it"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'happy path'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" origin "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(" num"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"0"),s(),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token comment"},"// \u901A\u8FC7 reactive \u521B\u5EFA\u54CD\u5E94\u5F0F\u5BF9\u8C61"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" reactiveData "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"reactive"),n("span",{class:"token punctuation"},"("),s("origin"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token comment"},"// \u5224\u65AD\u54CD\u5E94\u5F0F\u5BF9\u8C61\u4E0E\u539F\u5BF9\u8C61\u4E0D\u662F\u540C\u4E00\u4E2A\u5BF9\u8C61"),s(`
    `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("reactiveData"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("not"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBe"),n("span",{class:"token punctuation"},"("),s("origin"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token comment"},"// \u4EE3\u7406\u5BF9\u8C61\u4E2D\u7684 num \u503C\u5E94\u4E0E\u539F\u5BF9\u8C61\u4E2D\u7684\u76F8\u540C"),s(`
    `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("reactiveData"),n("span",{class:"token punctuation"},"."),s("num"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),S=n("h3",{id:"\u5B9E\u73B0-reactive",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u5B9E\u73B0-reactive","aria-hidden":"true"},"#"),s(" \u5B9E\u73B0 "),n("code",null,"reactive")],-1),T=s("\u901A\u8FC7\u6D4B\u8BD5\u7528\u4F8B\u6211\u4EEC\u4E0D\u96BE\u53D1\u73B0\uFF0C\u5176\u5B9E "),B=n("code",null,"reactive",-1),G=s(" \u505A\u7684\u4E8B\u60C5\u5F88\u7B80\u5355\uFF0C\u5C31\u662F\u521B\u5EFA\u4E00\u4E2A\u5BF9\u8C61\u526F\u672C\uFF0C\u90A3\u8FD9\u4E2A "),N=n("strong",null,"\u526F\u672C",-1),P=s(" \u8BE5\u600E\u4E48\u521B\u5EFA\u5462\uFF1F\u7B54\u6848\u662F\u4F7F\u7528 "),z={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy",target:"_blank",rel:"noopener noreferrer"},q=s("Proxy"),I=s(" \u{1F447}"),O=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/reactive.ts"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"reactive"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("raw"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Proxy"),n("span",{class:"token punctuation"},"("),s("raw"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u53D6\u503C"),s(`
    `),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" res "),n("span",{class:"token operator"},"="),s(" Reflect"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token keyword"},"return"),s(` res
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token comment"},"// \u8D4B\u503C"),s(`
    `),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" res "),n("span",{class:"token operator"},"="),s(" Reflect"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token keyword"},"return"),s(` res
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),V=o('<h2 id="\u54CD\u5E94\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u54CD\u5E94\u5F0F" aria-hidden="true">#</a> \u54CD\u5E94\u5F0F</h2><p>\u73B0\u5728\u6211\u4EEC\u5DF2\u7ECF\u53EF\u4EE5\u901A\u8FC7 <code>reactive</code> \u65B9\u6CD5\u83B7\u53D6\u76EE\u6807\u5BF9\u8C61\u7684 <strong>\u526F\u672C</strong> \u4E86\uFF0C\u90A3 <strong>\u54CD\u5E94\u5F0F</strong> \u90E8\u5206\u53C8\u8BE5\u5982\u4F55\u5B9E\u73B0\u5462\uFF1F</p><p>\u6240\u8C13 <strong>\u54CD\u5E94\u5F0F</strong>\uFF0C \u5176\u5B9E\u672C\u8D28\u4E0A\u5C31\u505A\u4E86\u4E24\u4EF6\u4E8B\u60C5\uFF1A</p><blockquote><ol><li>\u5728\u8BFB\u53D6\u5BF9\u8C61\u5C5E\u6027\u65F6\u8FDB\u884C <code>\u4F9D\u8D56\u6536\u96C6</code></li><li>\u5728\u4FEE\u6539\u5BF9\u8C61\u5C5E\u6027\u65F6\u6267\u884C <code>\u4F9D\u8D56\u89E6\u53D1</code></li></ol></blockquote><p>\u800C\u8FD9\u90E8\u5206\u7684\u903B\u8F91\u5219\u4EA4\u7531 <code>effect</code> \u6A21\u5757\u6765\u5B9E\u73B0\u3002\u90A3 <code>\u4F9D\u8D56\u6536\u96C6</code> \u8DDF <code>\u4F9D\u8D56\u89E6\u53D1</code> \u5177\u4F53\u662F\u600E\u6837\u7684\u4E00\u4E2A\u6D41\u7A0B\u5462\uFF1F\u8BF7\u770B\u4E0B\u56FE\uFF1A</p><p><img src="https://user-images.githubusercontent.com/9375823/173803951-43576337-7bba-423d-a985-5c0eb9dfb052.png" alt="track&amp;trigger"></p><p>\u5BF9\u4E0A\u56FE\u7684\u5185\u5BB9\u7B80\u5355\u63CF\u8FF0\u5982\u4E0B\uFF1A</p><blockquote><ol><li>\u5728\u8BFB\u53D6\u54CD\u5E94\u5F0F\u5BF9\u8C61 <code>Target</code> \u4E2D\u7684\u5C5E\u6027\u65F6\u8FDB\u884C <code>\u4F9D\u8D56\u6536\u96C6</code> \u64CD\u4F5C\uFF0C\u6240\u6709\u7684\u4F9D\u8D56\u4F1A\u88AB\u6536\u96C6\u5230\u4F9D\u8D56\u6C60 <code>TargetMap</code> \u4E2D\uFF1B</li><li>\u5728\u8BBE\u7F6E\u54CD\u5E94\u5F0F\u5BF9\u8C61 <code>Target</code> \u7684\u5C5E\u6027\u503C\u65F6\u6267\u884C <code>\u4F9D\u8D56\u89E6\u53D1</code> \u64CD\u4F5C\uFF0C\u4F1A\u6839\u636E\u5BF9\u5E94\u7684 <code>Target</code> \u4EE5\u53CA <code>key</code> \u5C06\u4F9D\u8D56\u4ECE\u4F9D\u8D56\u6C60 <code>TargetMap</code> \u4E2D\u53D6\u51FA\u5E76\u6267\u884C\u3002</li></ol></blockquote><p>\u73B0\u5728\u6211\u4EEC\u5DF2\u7ECF\u77E5\u9053\u4E86 <code>effect</code> \u6A21\u5757\u6240\u8981\u5B9E\u73B0\u7684\u529F\u80FD\uFF0C\u4F9D\u636E\u4E0A\u8FF0\u5185\u5BB9\uFF0C\u5148\u6765\u7F16\u5199\u4E0B\u6D4B\u8BD5\u7528\u4F8B\uFF1A</p>',9),j=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/__tests__/effect.spec.ts"),s(`

`),n("span",{class:"token function"},"describe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'effect'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"it"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'happy path'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u521B\u5EFA\u54CD\u5E94\u5F0F\u5BF9\u8C61"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" user "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"reactive"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
      age`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token number"},"10"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"let"),s(` nextAge
    `),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      nextAge `),n("span",{class:"token operator"},"="),s(" user"),n("span",{class:"token punctuation"},"."),s("age "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"1"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token comment"},"// \u4F20\u5165 effect \u7684\u65B9\u6CD5\u4F1A\u88AB\u7ACB\u5373\u6267\u884C\u4E00\u6B21"),s(`
    `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("nextAge"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"11"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token comment"},"// \u4FEE\u6539\u54CD\u5E94\u5F0F\u5BF9\u8C61\u7684\u5C5E\u6027\u503C"),s(`
    user`),n("span",{class:"token punctuation"},"."),s("age"),n("span",{class:"token operator"},"++"),s(`
    `),n("span",{class:"token comment"},"// \u4F20\u5165 effect \u7684\u65B9\u6CD5\u4F1A\u518D\u6B21\u88AB\u6267\u884C"),s(`
    `),n("span",{class:"token function"},"expect"),n("span",{class:"token punctuation"},"("),s("nextAge"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"12"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),A=n("h3",{id:"\u5B9E\u73B0-effect",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u5B9E\u73B0-effect","aria-hidden":"true"},"#"),s(" \u5B9E\u73B0 "),n("code",null,"effect")],-1),D=n("p",null,[s("\u63A5\u4E0B\u6765\u6211\u4EEC\u9700\u8981\u5B9E\u73B0 "),n("code",null,"effect"),s(" \u6A21\u5757\u7684\u529F\u80FD\u3002")],-1),J=n("p",null,[s("\u6839\u636E\u4E0A\u9762\u7684\u63CF\u8FF0\uFF0C"),n("code",null,"effect"),s(" \u63A5\u53D7\u4E00\u4E2A\u51FD\u6570\u4F5C\u4E3A\u53C2\u6570\uFF0C\u65E2\u5982\u6B64\u5148\u5B9A\u4E49\u4E00\u4E0B "),n("code",null,"effect"),s(" \u65B9\u6CD5\uFF1A")],-1),W=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/effect.ts"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),s("fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),L=s("\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u9700\u8981\u5B9A\u4E49\u4F9D\u8D56\u6C60 "),F=n("code",null,"targetMap",-1),H=s(" \u7528\u4E8E\u5B58\u653E\u4F9D\u8D56\u3002\u4F9D\u8D56\u6C60\u4E2D\u5B58\u653E\u7684\u662F\u54CD\u5E94\u5F0F\u5BF9\u8C61 "),K=n("code",null,"target",-1),Q=s(" \u6240\u5BF9\u5E94\u7684\u4F9D\u8D56\uFF0C\u9700\u8981\u4F7F\u7528\u5BF9\u8C61\u7C7B\u578B\u4F5C key \u7684\u8BDD\uFF0C\u90A3\u4E48\u4F7F\u7528 "),U={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map",target:"_blank",rel:"noopener noreferrer"},X=s("Map"),Y=s(" \u81EA\u7136\u518D\u5408\u9002\u4E0D\u8FC7\u5566\uFF1A"),Z=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/effect.ts"),s(`

`),n("span",{class:"token keyword"},"const"),s(" targetMap "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Map"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),s("fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),$=o("<p>\u597D\u4E86\uFF0C\u73B0\u5728\u5B58\u653E\u4F9D\u8D56\u7684\u5730\u65B9\u6709\u4E86\uFF0C\u90A3\u4E48\u6211\u4EEC\u5C31\u5F00\u59CB\u6536\u96C6\u5B83\u4EEC\u5427~</p><p>\u4E0A\u6587\u4E2D\u6211\u4EEC\u63D0\u5230\uFF0C<code>\u6536\u96C6\u4F9D\u8D56</code> \u7684\u64CD\u4F5C\u662F\u5728\u8BFB\u53D6\u54CD\u5E94\u5F0F\u5BF9\u8C61 <code>target</code> \u4E2D\u7684\u5C5E\u6027\u65F6\u8FDB\u884C\u7684\u3002\u8FD8\u8BB0\u5F97 <code>target</code> \u5BF9\u8C61\u662F\u901A\u8FC7 <code>Proxy</code> \u521B\u5EFA\u51FA\u6765\u7684\u4E48\uFF1F\u5728\u8BFB\u53D6 <code>target</code> \u7684\u5C5E\u6027\u65F6\uFF0C\u5FC5\u7136\u4F1A\u89E6\u53D1 <code>get</code> \u65B9\u6CD5\uFF0C\u90A3\u4E48 <code>\u6536\u96C6\u4F9D\u8D56</code> \u7684\u64CD\u4F5C\u4E5F\u5E94\u8BE5\u5728 <code>get</code> \u65B9\u6CD5\u4E2D\u8FDB\u884C\u3002</p><p>\u6211\u4EEC\u5148\u6765\u5B9A\u4E49\u4E00\u4E2A\u65B9\u6CD5 <code>tarck</code> \u7528\u4E8E\u4F9D\u8D56\u6536\u96C6\uFF0C\u5E76\u5728 <code>reactive.ts</code> \u4E2D\u5F15\u5165\u5B83\uFF0C\u4EE5\u4FBF\u5728 <code>get</code> \u65B9\u6CD5\u4E2D\u8FDB\u884C\u8C03\u7528\uFF1A</p>",3),nn=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/effect.ts"),s(`

`),n("span",{class:"token keyword"},"const"),s(" targetMap "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Map"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token doc-comment comment"},[s(`/**
 * \u6536\u96C6\u4F9D\u8D56
 * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"target"),s(` \u9700\u8981\u6536\u96C6\u4F9D\u8D56\u7684\u5BF9\u8C61
 * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"key"),s(` \u6536\u96C6\u8BE5key\u6240\u5BF9\u5E94\u7684\u4F9D\u8D56
 */`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"track"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),s("fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),sn=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[s(`
`),n("span",{class:"token comment"},"// src/reactivity/reactive.ts"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" track "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./effect'"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"reactive"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("raw"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Proxy"),n("span",{class:"token punctuation"},"("),s("raw"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u53D6\u503C"),s(`
    `),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" res "),n("span",{class:"token operator"},"="),s(" Reflect"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token comment"},"// \u6536\u96C6\u4F9D\u8D56"),s(`
      `),n("span",{class:"token function"},"track"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token keyword"},"return"),s(` res
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token comment"},"// \u8D4B\u503C"),s(`
    `),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" res "),n("span",{class:"token operator"},"="),s(" Reflect"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token keyword"},"return"),s(` res
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),en=n("p",null,[s("\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u9700\u8981\u5B9E\u73B0 "),n("code",null,"track"),s(" \u8FD9\u90E8\u5206\u7684\u529F\u80FD\u3002\u5728\u52A8\u624B\u5B9E\u73B0\u4E4B\u524D\uFF0C\u6211\u4EEC\u5148\u6765\u634B\u4E00\u634B "),n("code",null,"track"),s(" \u9700\u8981\u505A\u54EA\u4E9B\u4E8B\u60C5:")],-1),an=o("<li>\u7531\u4E8E\u5728\u521D\u59CB\u5316\u65F6\u4F9D\u8D56\u6C60\u662F\u7A7A\u7684\uFF08\u4E5F\u4E3A\u4E86\u907F\u514D\u8986\u76D6\uFF09\uFF0C\u6240\u4EE5\u5728\u5B58\u5165 <code>targetMap</code> \u4F9D\u8D56\u6C60\u4E4B\u524D\uFF0C\u9700\u8981\u5148\u5224\u65AD\u4F9D\u8D56\u6C60\u4E2D\u662F\u5426\u5DF2\u7ECF\u5B58\u5728 <code>target</code> \u6240\u5BF9\u5E94\u7684\u4F9D\u8D56\u5BB9\u5668 <code>depsMap</code>\uFF1A <ul><li>\u5982\u679C\u5B58\u5728\uFF0C\u5219\u53D6\u51FA <code>depsMap</code>;</li><li>\u5426\u5219\u65B0\u5EFA\u4E00\u4E2A <code>depsMap</code>, \u5E76\u5C06\u5176\u5B58\u5165\u5230\u4F9D\u8D56\u6C60 <code>targetMap</code> \u4E2D;</li></ul></li>",1),tn=s("\u4ECE\u4F9D\u8D56\u5BB9\u5668 "),cn=n("code",null,"depsMap",-1),on=s(" \u4E2D\u53D6\u51FA\u54CD\u5E94\u5F0F\u5BF9\u8C61 "),ln=n("code",null,"target",-1),pn=s(" \u5BF9\u5E94\u5C5E\u6027\u7684\u4F9D\u8D56 "),un=n("code",null,"deps",-1),rn=s("\uFF0C\u7531 "),kn=n("code",null,"\u6B65\u9AA41",-1),dn=s(" \u53EF\u77E5\uFF0C"),mn=n("code",null,"depsMap",-1),bn=s(" \u53EF\u80FD\u662F\u7A7A\u7684\uFF0C\u56E0\u6B64\u4E5F\u9700\u8981\u5BF9 "),vn=n("code",null,"deps",-1),fn=s(" \u8FDB\u884C\u5224\u7A7A\u5904\u7406\uFF1A "),_n=n("li",null,"\u5982\u679C\u5B58\u5728\uFF0C\u5219\u53D6\u51FA\uFF0C\u5E76\u5C06\u4F9D\u8D56\u5B58\u5165",-1),gn=s("\u5982\u679C\u4E0D\u5B58\u5728\uFF0C\u5219\u65B0\u5EFA\u4E00\u4E2A "),hn=n("code",null,"deps",-1),yn=s("\uFF0C\u5C06\u4F9D\u8D56\u5B58\u5165\u5176\u4E2D\uFF0C\u5E76\u5C06 "),wn=n("code",null,"deps",-1),xn=s(" \u5B58\u5165\u5BF9\u5E94\u5C5E\u6027\u7684\u4F9D\u8D56\u5BB9\u5668 "),Mn=n("code",null,"depsMap",-1),En=s(" \u4E2D\u3002\u4E3A\u4E86\u907F\u514D\u91CD\u590D\u6536\u96C6\u4F9D\u8D56\uFF0C\u6B64\u5904\u4F7F\u7528 "),Rn={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Set",target:"_blank",rel:"noopener noreferrer"},Cn=s("Set"),Sn=s(" \u8FDB\u884C\u5B58\u50A8\u3002"),Tn=n("p",null,"\u4E3A\u4E86\u65B9\u4FBF\u7406\u89E3\uFF0C\u6211\u4EEC\u6765\u4E00\u8D77\u770B\u4E0B\u6D41\u7A0B\u56FE:",-1),Bn=n("p",null,[n("img",{src:"https://user-images.githubusercontent.com/9375823/174035124-13a100ba-3e6a-4da0-a9f9-ff74acef6942.png",alt:"tarck"})],-1),Gn=n("p",null,"\u4EE3\u7801\u5B9E\u73B0\u5982\u4E0B\uFF1A",-1),Nn=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/effect.ts"),s(`

`),n("span",{class:"token keyword"},"const"),s(" targetMap "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Map"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token doc-comment comment"},[s(`/**
 * \u6536\u96C6\u4F9D\u8D56
 * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"target"),s(` \u9700\u8981\u6536\u96C6\u4F9D\u8D56\u7684\u5BF9\u8C61
 * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"key"),s(` \u6536\u96C6\u8BE5key\u6240\u5BF9\u5E94\u7684\u4F9D\u8D56
 */`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"track"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u67E5\u627E\u8BE5\u5BF9\u8C61\u5BF9\u5E94\u7684\u4F9D\u8D56\u6C60"),s(`
  `),n("span",{class:"token keyword"},"let"),s(" depsMap "),n("span",{class:"token operator"},"="),s(" targetMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token comment"},"// \u5982\u679C\u6CA1\u6709\uFF08\u9996\u6B21\u521D\u59CB\u5316\u65F6\uFF09\uFF0C\u5219\u521B\u5EFA\u65B0\u7684\u4F9D\u8D56\u6C60"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("depsMap"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    depsMap `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Map"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    targetMap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" depsMap"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token comment"},"// \u4ECE\u83B7\u53D6\u5230\u7684\u4F9D\u8D56\u6C60\u4E2D\u83B7\u53D6\u8BE5key\u6240\u5BF9\u5E94\u7684\u4F9D\u8D56\u5217\u8868"),s(`
  `),n("span",{class:"token keyword"},"let"),s(" deps "),n("span",{class:"token operator"},"="),s(" depsMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token comment"},"// \u5982\u679C\u6CA1\u6709\uFF0C\u5219\u65B0\u5EFA\u4E00\u4E2A\u8BE5key\u5BF9\u5E94\u7684\u5217\u8868"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("deps"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    deps `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    depsMap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},","),s(" deps"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token comment"},"// TODO \u5C06\u4F9D\u8D56\u5BF9\u8C61\u4FDD\u5B58\u5230\u5217\u8868\u4E2D"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),s("fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),Pn=o('<p>\u597D\uFF0C\u4EE3\u7801\u5199\u5230\u8FD9\u91CC\u7684\u65F6\u5019\uFF0C\u6211\u4EEC\u9047\u5230\u4E86\u4E00\u4E2A</p><div class="custom-container warning"><p class="custom-container-title">\u95EE\u9898\uFF1A</p><p><strong>\u9700\u8981\u88AB\u6536\u96C6\u7684\u4F9D\u8D56\u5728 <code>effect</code> \u65B9\u6CD5\u4E2D\uFF0C\u5728 <code>tarck</code> \u91CC\u8981\u600E\u4E48\u83B7\u53D6\u5230\u8FD9\u4E2A\u4F9D\u8D56\u5462\uFF1F</strong></p></div><p>\u9488\u5BF9\u8FD9\u4E2A\u95EE\u9898\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u5B9A\u4E49\u4E00\u4E2A\u7528\u4E8E\u5B58\u50A8\u4F9D\u8D56\u7684\u5168\u5C40\u53D8\u91CF <code>activeEffect</code> \u6765\u89E3\u51B3\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u3002\u90A3\u6211\u4EEC\u76F4\u63A5\u628A\u4F9D\u8D56\u585E\u5230 <code>activeEffect</code> \u4E2D\u5C31\u5B8C\u4E8B\u513F\u4E86\u4E48\uFF1F\u5F53\u7136\u3002\u3002\u3002\u3002</p><p><img src="https://user-images.githubusercontent.com/9375823/174023015-d484f98f-45e1-4a1e-a894-8333ce565729.png" alt="\u8FBE\u54A9"></p><p>\u4E0D\u662F\uFF01\u5982\u679C\u53EA\u5355\u5355\u4E3A\u4E86\u5B9E\u73B0\u8FD9\u4E2A\u529F\u80FD\uFF0C\u65E0\u53EF\u539A\u975E\uFF0C\u4F46\u662F\u540E\u7EED\u6211\u4EEC\u8FD8\u6709\u5176\u4ED6\u64CD\u4F5C\uFF08\u4E3A\u4E86\u4EE3\u7801\u7684\u5065\u58EE\u6027\uFF0C\u53EF\u8BFB\u6027\uFF0C \u53EF\u6269\u5C55\u6027\uFF09\uFF0C\u8FD9\u91CC\u6211\u4EEC\u5B9A\u4E49 <code>ReactiveEffect</code> \u7C7B\u5C06\u4F9D\u8D56\u6536\u96C6\u8D77\u6765\uFF0C\u4E4B\u540E\u5C06\u8BE5\u7C7B\u7684\u5B9E\u4F8B\u8D4B\u503C\u7ED9 <code>activeEffect</code> \u5373\u53EF\uFF1A</p>',5),zn=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/effect.ts"),s(`

`),n("span",{class:"token keyword"},"let"),s(` activeEffect

`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"ReactiveEffect"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"private"),s(" _fn"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),s(`
  
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),s("fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_fn "),n("span",{class:"token operator"},"="),s(` fn
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"run"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    activeEffect `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_fn"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"const"),s(" targetMap "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Map"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token doc-comment comment"},[s(`/**
 * \u6536\u96C6\u4F9D\u8D56
 * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"target"),s(` \u9700\u8981\u6536\u96C6\u4F9D\u8D56\u7684\u5BF9\u8C61
 * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"key"),s(` \u6536\u96C6\u8BE5key\u6240\u5BF9\u5E94\u7684\u4F9D\u8D56
 */`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"track"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u67E5\u627E\u8BE5\u5BF9\u8C61\u5BF9\u5E94\u7684\u4F9D\u8D56\u6C60"),s(`
  `),n("span",{class:"token keyword"},"let"),s(" depsMap "),n("span",{class:"token operator"},"="),s(" targetMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token comment"},"// \u5982\u679C\u6CA1\u6709\uFF08\u9996\u6B21\u521D\u59CB\u5316\u65F6\uFF09\uFF0C\u5219\u521B\u5EFA\u65B0\u7684\u4F9D\u8D56\u6C60"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("depsMap"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    depsMap `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Map"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    targetMap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" depsMap"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token comment"},"// \u4ECE\u83B7\u53D6\u5230\u7684\u4F9D\u8D56\u6C60\u4E2D\u83B7\u53D6\u8BE5key\u6240\u5BF9\u5E94\u7684\u4F9D\u8D56\u5217\u8868"),s(`
  `),n("span",{class:"token keyword"},"let"),s(" deps "),n("span",{class:"token operator"},"="),s(" depsMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token comment"},"// \u5982\u679C\u6CA1\u6709\uFF0C\u5219\u65B0\u5EFA\u4E00\u4E2A\u8BE5key\u5BF9\u5E94\u7684\u5217\u8868"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("deps"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    deps `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    depsMap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},","),s(" deps"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token comment"},"// \u5C06\u4F9D\u8D56\u5BF9\u8C61\u4FDD\u5B58\u5230\u5217\u8868\u4E2D"),s(`
  deps`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),s("activeEffect"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"effect"),n("span",{class:"token punctuation"},"("),s("fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u5B9E\u4F8B\u5316 ReactiveEffect \u7C7B\uFF0C\u5E76\u5C06\u4F9D\u8D56\u4F20\u5165"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" _effect "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ReactiveEffect"),n("span",{class:"token punctuation"},"("),s("fn"),n("span",{class:"token punctuation"},")"),s(`
  
  _effect`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"run"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("div",{class:"highlight-line"},"\xA0"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),qn=o('<div class="custom-container warning"><p class="custom-container-title">\u6CE8\u610F</p><p>\u8FD9\u91CC\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u4F20\u5165 <code>effect</code> \u4E2D\u7684\u65B9\u6CD5\u4F1A\u88AB\u7ACB\u5373\u6267\u884C\u4E00\u6B21\uFF08\u53EF\u4EE5\u56DE\u770B\u4E0A\u8FF0\u6D4B\u8BD5\u7528\u4F8B\u4E2D\u7684 <code>\u7B2C14\u884C\u4EE3\u7801</code>\uFF09\u3002\u6240\u4EE5 <code>ReactiveEffect</code> \u66B4\u9732\u7684 <code>run</code> \u65B9\u6CD5\u4E2D\u9664\u4E86\u8981\u5C06\u4F9D\u8D56\u5B58\u5165\u5168\u5C40\u53D8\u91CF <code>activeEffect</code> \u4E2D\uFF0C\u8FD8\u5F97\u5C06\u4F20\u5165\u7684\u4F9D\u8D56\u8FD4\u56DE\u51FA\u6765\u7528\u4EE5\u6267\u884C\u3002</p></div><p>\u5230\u76EE\u524D\u4E3A\u6B62\uFF0C<code>\u4F9D\u8D56\u6536\u96C6</code> \u7684\u529F\u80FD\u5C31\u5DF2\u7ECF\u5B9E\u73B0\u4E86\u3002\u63A5\u4E0B\u6765\u4FBF\u8F6E\u5230 <code>\u4F9D\u8D56\u89E6\u53D1</code> \u4E86\u3002\u76F8\u8F83\u4E8E <code>\u4F9D\u8D56\u6536\u96C6</code>\uFF0C<code>\u4F9D\u8D56\u89E6\u53D1</code> \u5C31\u7B80\u5355\u4E86\uFF0C\u53EA\u9700\u8981\u6839\u636E\u4F20\u5165\u7684 <code>target</code> \u4EE5\u53CA\u5BF9\u5E94\u7684\u5C5E\u6027 <code>key</code>\uFF0C\u5C06\u4F9D\u8D56\u9879\u53D6\u51FA\u6267\u884C\u4FBF\u53EF\u3002</p><p>\u8FD9\u91CC\u6211\u4EEC\u5728 <code>effect.ts</code> \u4E2D\u5B9A\u4E49\u4E00\u4E2A <code>trigger</code> \u65B9\u6CD5\u7528\u4E8E\u89E6\u53D1\u4F9D\u8D56\uFF0C\u4E4B\u540E\u5728 <code>reactive.ts</code> \u4E2D\u5F15\u5165\u3002\u7531\u4E8E\u89E6\u53D1\u4F9D\u8D56\u53D1\u751F\u5728\u4FEE\u6539\u54CD\u5E94\u5F0F\u5BF9\u8C61 <code>target</code> \u7684\u5C5E\u6027\u9636\u6BB5\uFF0C\u6240\u4EE5\u9700\u8981\u653E\u5230 <code>set</code> \u4E2D\u6267\u884C:</p>',3),In=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/effect.ts"),s(`

`),n("span",{class:"token doc-comment comment"},[s(`/**
 * \u89E6\u53D1\u4F9D\u8D56
 * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"target"),s(` \u89E6\u53D1\u4F9D\u8D56\u7684\u5BF9\u8C61
 * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"key"),s(` \u89E6\u53D1\u8BE5key\u5BF9\u5E94\u7684\u4F9D\u8D56
 */`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"trigger"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// \u6839\u636E\u5BF9\u8C61\u4E0Ekey\u83B7\u53D6\u5230\u6240\u6709\u7684\u4F9D\u8D56\uFF0C\u5E76\u6267\u884C"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" depsMap "),n("span",{class:"token operator"},"="),s(" targetMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" deps "),n("span",{class:"token operator"},"="),s(" depsMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token keyword"},"for"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"const"),s(" dep "),n("span",{class:"token keyword"},"of"),s(" deps"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    dep`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"run"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),On=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// src/reactivity/reactive.ts"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" track"),n("span",{class:"token punctuation"},","),s(" trigger "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./effect'"),s(`

`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"reactive"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("raw"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Proxy"),n("span",{class:"token punctuation"},"("),s("raw"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u53D6\u503C"),s(`
    `),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" res "),n("span",{class:"token operator"},"="),s(" Reflect"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token comment"},"// \u6536\u96C6\u4F9D\u8D56"),s(`
      `),n("span",{class:"token function"},"track"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token keyword"},"return"),s(` res
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token comment"},"// \u8D4B\u503C"),s(`
    `),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" res "),n("span",{class:"token operator"},"="),s(" Reflect"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token comment"},"// \u89E6\u53D1\u4F9D\u8D56"),s(`
      `),n("span",{class:"token function"},"trigger"),n("span",{class:"token punctuation"},"("),s("target"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token keyword"},"return"),s(` res
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),Vn=n("p",null,[s("\u81F3\u6B64\uFF0C"),n("code",null,"\u4F9D\u8D56\u6536\u96C6"),s(" & "),n("code",null,"\u89E6\u53D1\u4F9D\u8D56"),s(" \u7684\u529F\u80FD\u5C31\u5B8C\u6210\u5566~")],-1);function jn(An,Dn){const l=p("ExternalLinkIcon"),t=p("CodeGroupItem"),c=p("CodeGroup");return u(),r("div",null,[d,m,n("p",null,[b,n("a",v,[f,e(l)]),_,g,h,y,w,x,M]),E,R,e(c,null,{default:a(()=>[e(t,{title:"reactive.spec.ts"},{default:a(()=>[C]),_:1})]),_:1}),S,n("p",null,[T,B,G,N,P,n("a",z,[q,e(l)]),I]),e(c,null,{default:a(()=>[e(t,{title:"reactive.ts"},{default:a(()=>[O]),_:1})]),_:1}),V,e(c,null,{default:a(()=>[e(t,{title:"effect.spec.ts"},{default:a(()=>[j]),_:1})]),_:1}),A,D,J,e(c,null,{default:a(()=>[e(t,{title:"effect.ts"},{default:a(()=>[W]),_:1})]),_:1}),n("p",null,[L,F,H,K,Q,n("a",U,[X,e(l)]),Y]),e(c,null,{default:a(()=>[e(t,{title:"effect.ts"},{default:a(()=>[Z]),_:1})]),_:1}),$,e(c,null,{default:a(()=>[e(t,{title:"effect.ts"},{default:a(()=>[nn]),_:1}),e(t,{title:"reactive.ts"},{default:a(()=>[sn]),_:1})]),_:1}),en,n("blockquote",null,[n("ol",null,[an,n("li",null,[tn,cn,on,ln,pn,un,rn,kn,dn,mn,bn,vn,fn,n("ul",null,[_n,n("li",null,[gn,hn,yn,wn,xn,Mn,En,n("a",Rn,[Cn,e(l)]),Sn])])])])]),Tn,Bn,Gn,e(c,null,{default:a(()=>[e(t,{title:"effect.ts"},{default:a(()=>[Nn]),_:1})]),_:1}),Pn,e(c,null,{default:a(()=>[e(t,{title:"effect.ts"},{default:a(()=>[zn]),_:1})]),_:1}),qn,e(c,null,{default:a(()=>[e(t,{title:"effect.ts"},{default:a(()=>[In]),_:1}),e(t,{title:"reactive.ts"},{default:a(()=>[On]),_:1})]),_:1}),Vn])}var Wn=i(k,[["render",jn],["__file","01_reactive.html.vue"]]);export{Wn as default};
